project_name: driftsync

before:
  hooks:
    # éœ€è¦çš„è¯ï¼šåœ¨æ„å»ºå‰åšä¸€äº›ç”ŸæˆåŠ¨ä½œï¼ˆä¾‹ï¼šç”Ÿæˆå†…ç½®ç‰ˆæœ¬ä¿¡æ¯ã€é»˜è®¤é…ç½®ç­‰ï¼‰
    # - go generate ./...

builds:
  - id: driftsync
    main: ./cmd/driftsync
    env:
      - CGO_ENABLED=0
    ldflags:
      - -s -w
      # å¯é€‰ï¼šæŠŠç‰ˆæœ¬ä¿¡æ¯æ³¨å…¥åˆ°ä½ çš„åŒ…é‡Œï¼ˆä¿®æ”¹ä¸ºä½ çš„åŒ…è·¯å¾„ï¼‰
      # - -X github.com/your/module/internal/version.Version={{.Version}}
      # - -X github.com/your/module/internal/version.Commit={{.Commit}}
      # - -X github.com/your/module/internal/version.Date={{.Date}}
    goos:
      - linux
      - windows
    goarch:
      - amd64
      - arm64

archives:
  # Windows ç”¨ zipï¼›Linux ç”¨ tar.gz
  - id: by_os
    builds:
      - driftsync
    name_template: >-
      {{ .ProjectName }}_{{ .Version }}_{{ .Os }}_{{ .Arch }}
    format_overrides:
      - goos: windows
        format: zip
    files:
      # è¯»æˆ‘ç­‰é¢å¤–æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
      - LICENSE
      - README.md
    extra_files:
      # å¯é€‰ï¼šå½“ä»“åº“æ ¹ç›®å½•å­˜åœ¨ config.yaml æ—¶ï¼ŒæŠŠå®ƒä¸€å¹¶æ”¾å…¥å‹ç¼©åŒ…æ ¹ç›®å½•
      - glob: config.yaml
        # GoReleaser æ”¯æŒæŠŠé¢å¤–æ–‡ä»¶æ ‡è®°ä¸ºå¯é€‰ï¼ˆä¸å­˜åœ¨å°±å¿½ç•¥ï¼‰
        optional: true

nfpms:
  - id: linux-packages
    package_name: driftsync
    # è¿™é‡Œä¼šç”Ÿæˆ deb å’Œ rpm
    formats: [deb, rpm]
    section: utils
    priority: optional
    license: MIT
    maintainer: Your Name <you@example.com>
    description: "DriftSync â€” fast, reliable drift-aware sync tool."
    homepage: "https://github.com/xiaochun-z/driftsync"
    provides:
      - driftsync
    conflicts:
      - driftsync-beta
    recommends: []
    depends: []
    suggests: []
    # å®‰è£…è·¯å¾„ï¼šæŠŠäºŒè¿›åˆ¶æ”¾åˆ° /usr/bin
    bindir: /usr/bin
    contents:
      # å®‰è£…äºŒè¿›åˆ¶ï¼ˆç”± goreleaser è‡ªåŠ¨æŒ‡å‘æ„å»ºäº§ç‰©ï¼‰
      - src: ./dist/{{ .ProjectName }}_{{ .Version }}_linux_{{ .Arch }}/{{ .ProjectName }}
        dst: /usr/bin/{{ .ProjectName }}
        file_info:
          mode: 0755

      # ğŸ‘‰ï¼ˆå¯é€‰ï¼‰å½“ä½ å°†æ¥çœŸçš„è¦æŠŠ config.yaml éšåŒ…å®‰è£…åˆ° /etc/driftsync/ æ—¶ï¼š
      # æ³¨æ„ï¼šNFPM ä¸æ”¯æŒâ€œå¯é€‰æ–‡ä»¶â€ï¼Œsrc å¿…é¡»å­˜åœ¨æ‰èƒ½æ‰“åŒ…ã€‚
      # æ‰€ä»¥ï¼Œç­‰ä½ ä»“åº“é‡ŒåŠ å…¥ config.yaml åï¼Œå†å–æ¶ˆä»¥ä¸‹æ³¨é‡Šå³å¯ã€‚
      # - src: config.yaml
      #   dst: /etc/driftsync/config.yaml
      #   type: config # rpm ä¼šæ ‡è®°ä¸º noreplaceï¼Œç”¨æˆ·æ”¹åŠ¨ä¸ä¼šè¢«å‡çº§è¦†ç›–
      #   file_info:
      #     mode: 0644

    # æ ¹æ®æ¶æ„é‡å‘½åè¾“å‡ºæ–‡ä»¶
    formats_overrides:
      - format: deb
        file_name_template: >-
          {{ .ProjectName }}_{{ .Version }}_{{ .Arch }}.deb
      - format: rpm
        file_name_template: >-
          {{ .ProjectName }}-{{ .Version }}.{{ .Arch }}.rpm

release:
  # è®© goreleaser ç›´æ¥åˆ›å»º Draft Releaseï¼ˆè‰ç¨¿ï¼‰
  draft: true
  # ä¸º release å‘½åï¼ˆå¯è‡ªå®šä¹‰ï¼‰
  name_template: "DriftSync {{ .Version }}"
  # release notes å¯è‡ªåŠ¨ç”Ÿæˆï¼Œä¹Ÿå¯ä» CHANGELOG.md è¯»å–
  # æ›¿æ¢ä¸º true åˆ™ä¼šé™„ä¸Šå˜æ›´åˆ—è¡¨
  # changelog:
  #   use: github

changelog:
  sort: asc
  filters:
    exclude:
      - '^docs:'
      - '^test:'
